-- Rueda de Mensajes R√°pidos para M√≥vil
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local player = Players.LocalPlayer

-- Mensajes r√°pidos
local MENSAJES_RAPIDOS = {
    "ez",
    "chill", 
    "my bad",
    "desintala plz",
    "gg",
    "remato",
    "coloco",
    "pancho"
}

-- Colores para los botones
local COLORES = {
    Color3.fromRGB(255, 100, 100),
    Color3.fromRGB(255, 180, 100),
    Color3.fromRGB(255, 255, 100),
    Color3.fromRGB(180, 255, 100),
    Color3.fromRGB(100, 255, 180),
    Color3.fromRGB(100, 200, 255),
    Color3.fromRGB(180, 100, 255),
    Color3.fromRGB(255, 100, 200)
}

-- Variables
local screenGui, mainFrame, centerButton, botones = {}, nil
local ruedaAbierta = false
local arrastrando = false
local posicionInicial, posicionArrastre

-- FUNCIONES MEJORADAS PARA ENVIAR MENSAJES AL CHAT
local function ejecutarComandoChat(mensaje)
    print("üîä Intentando enviar: " .. mensaje)
    
    -- M√©todo 1: Usar funciones de chat existentes en el juego
    local funciono, resultado = pcall(function()
        -- Buscar el servicio de chat cl√°sico
        local eventosChat = game:GetService("ReplicatedStorage"):FindFirstChild("DefaultChatSystemChatEvents")
        if eventosChat then
            local decirMensaje = eventosChat:FindFirstChild("SayMessageRequest")
            if decirMensaje then
                decirMensaje:FireServer(mensaje, "All")
                return true, "Chat cl√°sico"
            end
        end
        return false
    end)
    
    if funciono then
        print("‚úÖ Enviado via chat cl√°sico: " .. mensaje)
        return true
    end
    
    -- M√©todo 2: Usar el nuevo TextChatService
    local funciono2, resultado2 = pcall(function()
        local textChatService = game:GetService("TextChatService")
        if textChatService then
            local canales = textChatService:FindFirstChild("TextChannels")
            if canales then
                local general = canales:FindFirstChild("RBXGeneral")
                if general then
                    general:SendAsync(mensaje)
                    return true, "TextChatService"
                end
            end
        end
        return false
    end)
    
    if funciono2 then
        print("‚úÖ Enviado via TextChatService: " .. mensaje)
        return true
    end
    
    -- M√©todo 3: Simular teclas para escribir en el chat
    local funciono3, resultado3 = pcall(function()
        -- Abrir chat con /
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Slash, false, game)
        wait(0.1)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Slash, false, game)
        
        -- Esperar a que aparezca el chat
        wait(0.3)
        
        -- Escribir el mensaje car√°cter por car√°cter
        for i = 1, #mensaje do
            local char = mensaje:sub(i, i)
            local keyCode = Enum.KeyCode.Unknown
            
            -- Mapear caracteres a KeyCodes (solo los b√°sicos)
            if char == " " then
                keyCode = Enum.KeyCode.Space
            elseif char == "!" then
                keyCode = Enum.KeyCode.One
                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.LeftShift, false, game)
            elseif char == "?" then
                keyCode = Enum.KeyCode.Slash  
                VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.LeftShift, false, game)
            else
                -- Para letras y n√∫meros simples
                local keyName = char:upper()
                local success, key = pcall(function() return Enum.KeyCode[keyName] end)
                if success then
                    keyCode = key
                end
            end
            
            if keyCode ~= Enum.KeyCode.Unknown then
                VirtualInputManager:SendKeyEvent(true, keyCode, false, game)
                wait(0.02)
                VirtualInputManager:SendKeyEvent(false, keyCode, false, game)
                wait(0.02)
            end
        end
        
        -- Liberar shift si estaba presionado
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.LeftShift, false, game)
        
        -- Presionar Enter para enviar
        wait(0.1)
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
        
        return true, "Simulaci√≥n de teclas"
    end)
    
    if funciono3 then
        print("‚úÖ Enviado via simulaci√≥n de teclas: " .. mensaje)
        return true
    end
    
    -- M√©todo 4: Usar commandos de administrador si est√°n disponibles
    local funciono4, resultado4 = pcall(function()
        -- Buscar si existe un sistema de comandos
        if _G.CMDs then
            for _, cmd in pairs(_G.CMDs) do
                if cmd.NAME:lower():find("chat") or cmd.NAME:lower():find("say") then
                    -- Simular el comando de chat
                    local comandoChat = "say " .. mensaje
                    print("üéØ Ejecutando comando: " .. comandoChat)
                    -- Aqu√≠ se ejecutar√≠a el comando del script
                    return true, "Sistema de comandos"
                end
            end
        end
        return false
    end)
    
    if funciono4 then
        print("‚úÖ Enviado via sistema de comandos: " .. mensaje)
        return true
    end
    
    -- Si todo falla, solo imprimir en consola
    print("‚ùå No se pudo enviar al chat, mensaje ser√≠a: " .. mensaje)
    return false
end

-- Funci√≥n mejorada para enviar mensaje
local function enviarMensaje(mensaje)
    print("üöÄ Intentando enviar mensaje r√°pido: " .. mensaje)
    
    -- Intentar todos los m√©todos de env√≠o
    local exito = ejecutarComandoChat(mensaje)
    
    -- Mostrar feedback visual
    if estadoLabel then
        if exito then
            estadoLabel.Text = "‚úÖ Enviado: " .. mensaje
            estadoLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        else
            estadoLabel.Text = "‚ùå Error al enviar"
            estadoLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        end
    end
    
    return exito
end

-- Crear la interfaz
local function crearInterfaz()
    -- ScreenGui principal
    screenGui = Instance.new("ScreenGui")
    screenGui.Name = "RuedaMensajes"
    screenGui.ResetOnSpawn = false
    
    -- Marco principal (movible)
    mainFrame = Instance.new("Frame")
    mainFrame.Name = "MarcoPrincipal"
    mainFrame.Size = UDim2.new(0, 200, 0, 200)
    mainFrame.Position = UDim2.new(0.1, 0, 0.7, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    
    local esquinas = Instance.new("UICorner")
    esquinas.CornerRadius = UDim.new(0.1, 0)
    esquinas.Parent = mainFrame
    
    local borde = Instance.new("UIStroke")
    borde.Color = Color3.fromRGB(100, 100, 255)
    borde.Thickness = 2
    borde.Parent = mainFrame
    
    -- Bot√≥n central para abrir/cerrar
    centerButton = Instance.new("TextButton")
    centerButton.Name = "BotonCentral"
    centerButton.Size = UDim2.new(0, 70, 0, 70)
    centerButton.Position = UDim2.new(0.5, -35, 0.5, -35)
    centerButton.AnchorPoint = Vector2.new(0.5, 0.5)
    centerButton.BackgroundColor3 = Color3.fromRGB(80, 120, 255)
    centerButton.BorderSizePixel = 0
    centerButton.Text = "üí¨\nMENSAJES"
    centerButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    centerButton.TextScaled = true
    centerButton.Font = Enum.Font.GothamBold
    centerButton.ZIndex = 10
    
    local centerEsquinas = Instance.new("UICorner")
    centerEsquinas.CornerRadius = UDim.new(1, 0)
    centerEsquinas.Parent = centerButton
    
    local centerBorde = Instance.new("UIStroke")
    centerBorde.Color = Color3.fromRGB(255, 255, 255)
    centerBorde.Thickness = 2
    centerBorde.Parent = centerButton
    
    centerButton.Parent = mainFrame
    
    -- Crear botones de mensajes en forma de rueda
    botones = {}
    local cantidadMensajes = #MENSAJES_RAPIDOS
    local radio = 80
    local anguloPorBoton = (2 * math.pi) / cantidadMensajes
    
    for i = 1, cantidadMensajes do
        local angulo = (i - 1) * anguloPorBoton
        local x = math.cos(angulo) * radio
        local y = math.sin(angulo) * radio
        
        local boton = Instance.new("TextButton")
        boton.Name = "Boton_" .. i
        boton.Size = UDim2.new(0, 60, 0, 60)
        boton.Position = UDim2.new(0.5, x - 30, 0.5, y - 30)
        boton.AnchorPoint = Vector2.new(0.5, 0.5)
        boton.BackgroundColor3 = COLORES[i]
        boton.BackgroundTransparency = 0.2
        boton.BorderSizePixel = 0
        boton.Text = MENSAJES_RAPIDOS[i]
        boton.TextColor3 = Color3.fromRGB(255, 255, 255)
        boton.TextScaled = true
        boton.Font = Enum.Font.GothamBold
        boton.ZIndex = 5
        boton.Visible = false
        
        local botonEsquinas = Instance.new("UICorner")
        botonEsquinas.CornerRadius = UDim.new(0.15, 0)
        botonEsquinas.Parent = boton
        
        local botonBorde = Instance.new("UIStroke")
        botonBorde.Color = Color3.fromRGB(255, 255, 255)
        botonBorde.Thickness = 1.5
        botonBorde.Parent = boton
        
        boton.Parent = mainFrame
        botones[i] = boton
    end
    
    -- Etiqueta de estado
    estadoLabel = Instance.new("TextLabel")
    estadoLabel.Name = "Estado"
    estadoLabel.Size = UDim2.new(1, -10, 0, 25)
    estadoLabel.Position = UDim2.new(0, 5, 1, 5)
    estadoLabel.BackgroundTransparency = 1
    estadoLabel.Text = "Toca para abrir"
    estadoLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    estadoLabel.TextScaled = true
    estadoLabel.Font = Enum.Font.Gotham
    estadoLabel.Visible = true
    
    estadoLabel.Parent = mainFrame
    
    mainFrame.Parent = screenGui
    return screenGui, estadoLabel
end

-- Funci√≥n para abrir la rueda con animaci√≥n
local function abrirRueda()
    if ruedaAbierta then return end
    
    ruedaAbierta = true
    centerButton.Visible = false
    
    -- Animaci√≥n de aparici√≥n de botones
    for i, boton in ipairs(botones) do
        boton.Visible = true
        boton.Size = UDim2.new(0, 10, 0, 10)
        boton.BackgroundTransparency = 0.8
        
        local infoTween = TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
        local tween = TweenService:Create(boton, infoTween, {
            Size = UDim2.new(0, 60, 0, 60),
            BackgroundTransparency = 0.2
        })
        tween:Play()
    end
    
    if estadoLabel then
        estadoLabel.Text = "üëÜ Elige un mensaje"
        estadoLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    end
end

-- Funci√≥n para cerrar la rueda con animaci√≥n
local function cerrarRueda()
    if not ruedaAbierta then return end
    
    ruedaAbierta = false
    
    -- Animaci√≥n de desaparici√≥n
    for i, boton in ipairs(botones) do
        local infoTween = TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.In)
        local tween = TweenService:Create(boton, infoTween, {
            Size = UDim2.new(0, 10, 0, 10),
            BackgroundTransparency = 0.8
        })
        tween:Play()
    end
    
    -- Ocultar botones despu√©s de la animaci√≥n
    delay(0.25, function()
        for _, boton in ipairs(botones) do
            boton.Visible = false
        end
        centerButton.Visible = true
    end)
    
    if estadoLabel then
        estadoLabel.Text = "Toca para abrir"
        estadoLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    end
end

-- Configurar interacciones
local function configurarInteracciones()
    -- Bot√≥n central
    centerButton.MouseButton1Click:Connect(function()
        if ruedaAbierta then
            cerrarRueda()
        else
            abrirRueda()
        end
    end)
    
    -- Configurar cada bot√≥n de mensaje
    for i, boton in ipairs(botones) do
        boton.MouseButton1Click:Connect(function()
            if not ruedaAbierta then return end
            
            local mensaje = MENSAJES_RAPIDOS[i]
            
            -- Efecto visual al presionar
            local colorOriginal = boton.BackgroundColor3
            boton.BackgroundTransparency = 0
            boton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            local textoOriginal = boton.Text
            boton.Text = "‚úì"
            
            -- Enviar mensaje con los m√©todos mejorados
            enviarMensaje(mensaje)
            
            -- Restaurar bot√≥n despu√©s de un momento
            delay(0.8, function()
                if boton then
                    boton.BackgroundTransparency = 0.2
                    boton.BackgroundColor3 = colorOriginal
                    boton.Text = textoOriginal
                end
            end)
            
            -- Cerrar rueda despu√©s de enviar
            delay(1.2, function()
                cerrarRueda()
            end)
        end)
        
        -- Efecto hover para PC
        boton.MouseEnter:Connect(function()
            if ruedaAbierta then
                boton.BackgroundTransparency = 0.1
            end
        end)
        
        boton.MouseLeave:Connect(function()
            if ruedaAbierta then
                boton.BackgroundTransparency = 0.2
            end
        end)
    end
    
    -- Hacer la ventana arrastrable
    mainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            arrastrando = true
            posicionArrastre = input.Position
            posicionInicial = mainFrame.Position
        end
    end)
    
    mainFrame.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            arrastrando = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if arrastrando and input.UserInputType == Enum.UserInputType.Touch then
            local diferencia = input.Position - posicionArrastre
            mainFrame.Position = UDim2.new(
                posicionInicial.X.Scale, 
                posicionInicial.X.Offset + diferencia.X,
                posicionInicial.Y.Scale, 
                posicionInicial.Y.Offset + diferencia.Y
            )
        end
    end)
end

-- Funci√≥n principal
local function inicializar()
    -- Crear interfaz
    screenGui, estadoLabel = crearInterfaz()
    
    -- Parentear correctamente
    if gethui then
        screenGui.Parent = gethui()
    elseif syn and syn.protect_gui then
        syn.protect_gui(screenGui)
        screenGui.Parent = game:GetService("CoreGui")
    else
        screenGui.Parent = game:GetService("CoreGui")
    end
    
    -- Configurar interacciones
    configurarInteracciones()
    
    print("üéØ Rueda de Mensajes R√°pidos CARGADA")
    print("üí¨ Bot√≥n central para abrir/cerrar")
    print("üëÜ 8 mensajes disponibles")
    print("üß≠ Arrastra para mover")
    print("üì± Optimizado para m√≥vil")
    print("üîä Sistema de env√≠o mejorado con 4 m√©todos")
end

-- Iniciar
inicializar()
