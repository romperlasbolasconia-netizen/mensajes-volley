-- Script de Rueda de Mensajes Interactiva Mejorada
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- Configuración de la rueda
local WHEEL_SECTIONS = 8
local WHEEL_RADIUS = 100
local CENTER_POSITION = UDim2.new(0.5, 0, 0.7, 0) -- Posición más baja para mejor acceso

-- Mensajes para cada sección
local SECTION_MESSAGES = {
    "Ez",
    "Stfu",
    "Chill",
    "Remato",
    "Desintala plz",
    "xd",
    "Nt",
    "tranquilo"
}

-- Colores para cada sección
local SECTION_COLORS = {
    Color3.fromRGB(255, 100, 100),
    Color3.fromRGB(255, 200, 100),
    Color3.fromRGB(100, 255, 100),
    Color3.fromRGB(100, 200, 255),
    Color3.fromRGB(200, 100, 255),
    Color3.fromRGB(255, 100, 200),
    Color3.fromRGB(100, 255, 255),
    Color3.fromRGB(255, 255, 100)
}

-- Variables globales
local wheelGUI, sections, centerCircle, selectedMessage, mainFrame
local isWheelVisible = false
local isMinimized = false
local wheelCenter = nil
local dragConnection = nil

-- Función para crear la interfaz gráfica
local function createWheelGUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "MessageWheel"
    screenGui.ResetOnSpawn = false
    
    -- Contenedor principal (ahora movible)
    mainFrame = Instance.new("Frame")
    mainFrame.Name = "WheelContainer"
    mainFrame.Size = UDim2.new(0, 250, 0, 250)
    mainFrame.Position = CENTER_POSITION
    mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    mainFrame.BackgroundTransparency = 0.2
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    mainFrame.Draggable = true -- Hacerlo movible
    mainFrame.Selectable = true
    
    local mainCorner = Instance.new("UICorner")
    mainCorner.CornerRadius = UDim.new(0.1, 0)
    mainCorner.Parent = mainFrame
    
    -- Barra de título con botones
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, 0, 0, 25)
    titleBar.Position = UDim2.new(0, 0, 0, 0)
    titleBar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    titleBar.BorderSizePixel = 0
    titleBar.ZIndex = 20
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0.1, 0)
    titleCorner.Parent = titleBar
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "TitleLabel"
    titleLabel.Size = UDim2.new(0.6, 0, 1, 0)
    titleLabel.Position = UDim2.new(0, 5, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "Rueda de Mensajes"
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextScaled = true
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.ZIndex = 21
    titleLabel.Parent = titleBar
    
    -- Botón minimizar
    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Name = "MinimizeBtn"
    minimizeBtn.Size = UDim2.new(0, 20, 0, 20)
    minimizeBtn.Position = UDim2.new(1, -45, 0, 2)
    minimizeBtn.AnchorPoint = Vector2.new(1, 0)
    minimizeBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
    minimizeBtn.BorderSizePixel = 0
    minimizeBtn.Text = "_"
    minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    minimizeBtn.TextScaled = true
    minimizeBtn.Font = Enum.Font.GothamBold
    minimizeBtn.ZIndex = 21
    
    local minimizeCorner = Instance.new("UICorner")
    minimizeCorner.CornerRadius = UDim.new(0.3, 0)
    minimizeCorner.Parent = minimizeBtn
    
    -- Botón cerrar
    local closeBtn = Instance.new("TextButton")
    closeBtn.Name = "CloseBtn"
    closeBtn.Size = UDim2.new(0, 20, 0, 20)
    closeBtn.Position = UDim2.new(1, -20, 0, 2)
    closeBtn.AnchorPoint = Vector2.new(1, 0)
    closeBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
    closeBtn.BorderSizePixel = 0
    closeBtn.Text = "X"
    closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeBtn.TextScaled = true
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.ZIndex = 21
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0.3, 0)
    closeCorner.Parent = closeBtn
    
    minimizeBtn.Parent = titleBar
    closeBtn.Parent = titleBar
    titleBar.Parent = mainFrame
    
    -- Círculo central
    centerCircle = Instance.new("Frame")
    centerCircle.Name = "Center"
    centerCircle.Size = UDim2.new(0, 60, 0, 60)
    centerCircle.Position = UDim2.new(0.5, -30, 0.5, -30)
    centerCircle.AnchorPoint = Vector2.new(0.5, 0.5)
    centerCircle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    centerCircle.BorderSizePixel = 0
    centerCircle.ZIndex = 10
    centerCircle.Visible = false
    
    local centerCorner = Instance.new("UICorner")
    centerCorner.CornerRadius = UDim.new(1, 0)
    centerCorner.Parent = centerCircle
    
    local centerLabel = Instance.new("TextLabel")
    centerLabel.Name = "CenterLabel"
    centerLabel.Size = UDim2.new(1, 0, 1, 0)
    centerLabel.BackgroundTransparency = 1
    centerLabel.Text = "TOCA"
    centerLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    centerLabel.TextScaled = true
    centerLabel.Font = Enum.Font.GothamBold
    centerLabel.Parent = centerCircle
    
    centerCircle.Parent = mainFrame
    
    -- Crear secciones de la rueda
    sections = {}
    local angleStep = 360 / WHEEL_SECTIONS
    
    for i = 1, WHEEL_SECTIONS do
        local section = Instance.new("Frame")
        section.Name = "Section_" .. i
        section.Size = UDim2.new(0, WHEEL_RADIUS * 2, 0, WHEEL_RADIUS * 2)
        section.Position = UDim2.new(0.5, -WHEEL_RADIUS, 0.5, -WHEEL_RADIUS)
        section.AnchorPoint = Vector2.new(0.5, 0.5)
        section.BackgroundTransparency = 0.7
        section.BackgroundColor3 = SECTION_COLORS[i]
        section.BorderSizePixel = 0
        section.ZIndex = 1
        section.Visible = false
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(1, 0)
        corner.Parent = section
        
        -- Clip para crear forma de quesito
        local clip = Instance.new("Frame")
        clip.Name = "Clip"
        clip.Size = UDim2.new(0.5, 0, 0.5, 0)
        clip.Position = UDim2.new(0.5, 0, 0.5, 0)
        clip.AnchorPoint = Vector2.new(0.5, 0.5)
        clip.BackgroundColor3 = section.BackgroundColor3
        clip.BorderSizePixel = 0
        clip.ZIndex = 2
        
        local clipCorner = Instance.new("UICorner")
        clipCorner.CornerRadius = UDim.new(0, 0)
        clipCorner.Parent = clip
        
        clip.Parent = section
        
        -- Etiqueta del mensaje
        local label = Instance.new("TextLabel")
        label.Name = "Label"
        label.Size = UDim2.new(0, 80, 0, 30)
        label.Position = UDim2.new(0.7, 0, 0.1, 0)
        label.BackgroundTransparency = 1
        label.Text = SECTION_MESSAGES[i]
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.TextScaled = true
        label.Font = Enum.Font.GothamBold
        label.TextStrokeTransparency = 0
        label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        label.ZIndex = 3
        label.Visible = false
        label.Parent = section
        
        section.Parent = mainFrame
        sections[i] = section
    end
    
    -- Texto de mensaje seleccionado
    selectedMessage = Instance.new("TextLabel")
    selectedMessage.Name = "SelectedMessage"
    selectedMessage.Size = UDim2.new(1, 0, 0, 40)
    selectedMessage.Position = UDim2.new(0, 0, 1, 10)
    selectedMessage.BackgroundTransparency = 1
    selectedMessage.Text = ""
    selectedMessage.TextColor3 = Color3.fromRGB(255, 255, 255)
    selectedMessage.TextScaled = true
    selectedMessage.Font = Enum.Font.GothamBold
    selectedMessage.TextStrokeTransparency = 0
    selectedMessage.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    selectedMessage.Visible = false
    selectedMessage.Parent = mainFrame
    
    mainFrame.Parent = screenGui
    return screenGui
end

-- Función para mostrar la rueda
local function showWheel()
    if isMinimized then
        -- Restaurar desde minimizado
        mainFrame.Size = UDim2.new(0, 250, 0, 250)
        isMinimized = false
    end
    
    centerCircle.Visible = true
    selectedMessage.Visible = false
    
    local angleStep = 360 / WHEEL_SECTIONS
    
    for i, section in ipairs(sections) do
        section.Visible = true
        section.BackgroundTransparency = 0.7
        
        -- Rotar la sección
        local startAngle = (i - 1) * angleStep
        local endAngle = i * angleStep
        local midAngle = (startAngle + endAngle) / 2
        
        -- Posicionar el clip para crear forma de quesito
        local clip = section:FindFirstChild("Clip")
        if clip then
            clip.Size = UDim2.new(0.5, 0, 0.5, 0)
            clip.Position = UDim2.new(0.5, 0, 0.5, 0)
            clip.Rotation = midAngle
        end
        
        -- Ocultar etiqueta inicialmente
        local label = section:FindFirstChild("Label")
        if label then
            label.Visible = false
        end
    end
    
    isWheelVisible = true
    
    -- Actualizar posición central
    local centerAbsPos = centerCircle.AbsolutePosition
    local centerSize = centerCircle.AbsoluteSize
    wheelCenter = Vector2.new(
        centerAbsPos.X + centerSize.X / 2,
        centerAbsPos.Y + centerSize.Y / 2
    )
end

-- Función para ocultar la rueda
local function hideWheel()
    centerCircle.Visible = false
    selectedMessage.Visible = false
    
    for _, section in ipairs(sections) do
        section.Visible = false
        local label = section:FindFirstChild("Label")
        if label then
            label.Visible = false
        end
    end
    
    isWheelVisible = false
end

-- Función para minimizar
local function minimizeWheel()
    if isMinimized then
        -- Restaurar
        mainFrame.Size = UDim2.new(0, 250, 0, 250)
        showWheel()
    else
        -- Minimizar
        mainFrame.Size = UDim2.new(0, 250, 0, 25)
        hideWheel()
    end
    isMinimized = not isMinimized
end

-- Función para detectar en qué sección se hizo clic
local function getSelectedSection(mousePosition, wheelCenter, sections)
    if not wheelCenter then return nil end
    
    local relativePos = Vector2.new(
        mousePosition.X - wheelCenter.X,
        mousePosition.Y - wheelCenter.Y
    )
    
    -- Calcular ángulo
    local angle = math.atan2(relativePos.Y, relativePos.X) * (180 / math.pi)
    if angle < 0 then
        angle = angle + 360
    end
    
    -- Calcular distancia desde el centro
    local distance = math.sqrt(relativePos.X^2 + relativePos.Y^2)
    
    -- Verificar si está dentro del radio
    if distance < 30 or distance > WHEEL_RADIUS then
        return nil
    end
    
    -- Determinar sección
    local angleStep = 360 / WHEEL_SECTIONS
    local sectionIndex = math.floor(angle / angleStep) + 1
    
    if sectionIndex > WHEEL_SECTIONS then
        sectionIndex = 1
    end
    
    return sectionIndex
end

-- Función principal
local function initializeWheel()
    wheelGUI = createWheelGUI()
    
    -- Insertar en el Parent adecuado
    if gethui then
        wheelGUI.Parent = gethui()
    elseif syn and syn.protect_gui then
        syn.protect_gui(wheelGUI)
        wheelGUI.Parent = game:GetService("CoreGui")
    else
        wheelGUI.Parent = game:GetService("CoreGui")
    end

    -- Obtener referencias a los botones
    local minimizeBtn = mainFrame.TitleBar:FindFirstChild("MinimizeBtn")
    local closeBtn = mainFrame.TitleBar:FindFirstChild("CloseBtn")
    
    -- Configurar botones
    if minimizeBtn then
        minimizeBtn.MouseButton1Click:Connect(function()
            minimizeWheel()
        end)
    end
    
    if closeBtn then
        closeBtn.MouseButton1Click:Connect(function()
            hideWheel()
        end)
    end
    
    -- Función para activar/desactivar la rueda
    local function toggleWheel()
        if isWheelVisible then
            hideWheel()
        else
            showWheel()
        end
    end
    
    -- Detectar entrada del teclado (tecla M)
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == Enum.KeyCode.M then
            toggleWheel()
        end
    end)
    
    -- También permitir abrir con clic en el centro
    centerCircle.MouseButton1Click:Connect(function()
        if not isWheelVisible then
            showWheel()
        end
    end)
    
    -- Detectar clic del mouse en las secciones
    for i, section in ipairs(sections) do
        section.MouseButton1Click:Connect(function()
            if not isWheelVisible then return end
            
            -- Mostrar mensaje seleccionado
            local message = SECTION_MESSAGES[i]
            selectedMessage.Text = "Mensaje: " .. message
            selectedMessage.Visible = true
            
            -- Resaltar sección seleccionada
            for j, sec in ipairs(sections) do
                if j == i then
                    sec.BackgroundTransparency = 0.3
                    local label = sec:FindFirstChild("Label")
                    if label then
                        label.Visible = true
                    end
                else
                    sec.BackgroundTransparency = 0.7
                    local label = sec:FindFirstChild("Label")
                    if label then
                        label.Visible = false
                    end
                end
            end
            
            -- Enviar mensaje al chat (opcional)
            if message then
                print("Mensaje seleccionado: " .. message)
                -- Para enviar al chat del juego, descomenta la siguiente línea:
                -- game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(message, "All")
            end
            
            -- Ocultar la rueda después de 2 segundos
            wait(2)
            if isWheelVisible then
                hideWheel()
            end
        end)
    end
    
    -- Mostrar el centro inicialmente (pero no la rueda completa)
    centerCircle.Visible = true
    
    -- Actualizar etiquetas en tiempo real cuando el mouse se mueve sobre las secciones
    RunService.RenderStepped:Connect(function()
        if not isWheelVisible or not wheelCenter then return end
        
        local mousePos = UserInputService:GetMouseLocation()
        local hoverIndex = getSelectedSection(mousePos, wheelCenter, sections)
        
        for i, section in ipairs(sections) do
            local label = section:FindFirstChild("Label")
            if label then
                label.Visible = (i == hoverIndex)
            end
        end
    end)
end

-- Inicializar la rueda
initializeWheel()

print("Rueda de mensajes cargada!")
print("Controles:")
print("- Presiona M para abrir/cerrar la rueda")
print("- Haz clic en el círculo central para abrir")
print("- Arrastra la barra de título para mover")
print("- Usa _ para minimizar")
print("- Haz clic en cualquier sección para enviar mensaje")
